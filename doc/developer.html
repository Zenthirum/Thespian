<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-03-06 Wed 00:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thespian Developer's Notes</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Kevin Quick &lt;quick@sparq.org&gt;" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="icon" type="image/png" href="/favicon.png" />
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Actor" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
<link href="thespian.css" rel="stylesheet" type="text/css"/>
<link href="thespian_developer.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title"><a href="https://thespianpy.com"><img src="thesplogo2.png" alt="Thespian" width="50%" style="inline" /></a> Developer's Notes</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#hH-851aafed-d085-49ed-b189-3bfd90a8e573">1. Source</a>
<ul>
<li><a href="#hH-273880cf-f38b-40bd-8ea0-95d03d668b29">1.1. Availability</a></li>
<li><a href="#hH-9ebe8005-1460-4634-bead-237826702ea2">1.2. Documentation</a></li>
<li><a href="#hH-e9695953-86ef-420c-a33a-4a0db2455a04">1.3. Issues</a></li>
<li><a href="#hH-a0f114cf-cfc2-4ae6-a852-a4db84986f57">1.4. Contributions</a></li>
</ul>
</li>
<li><a href="#hH-701a67c8-8882-49ff-928c-14ae0b663cbf">2. Testing</a>
<ul>
<li><a href="#hH-1c7bb213-1e22-455e-b767-c9a6a1a5cd68">2.1. Approach</a></li>
<li><a href="#hH-f099ef66-5ab1-45d7-a700-b065f885ca75">2.2. Test Duration</a></li>
<li><a href="#hH-1dfd22a5-0c88-4d8e-8e0d-5383a503678a">2.3. Testing System Bases</a></li>
<li><a href="#hH-a992a85a-623f-47c8-a810-deefcb82a521">2.4. Running Tests</a></li>
<li><a href="#hH-bf031295-256d-471e-922a-808a77c3fbec">2.5. Writing Tests</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org846e323" class="outline-2">
<h2 id="hH-851aafed-d085-49ed-b189-3bfd90a8e573"><a id="org846e323"></a><span class="section-number-2">1</span> Source</h2>
<div class="outline-text-2" id="text-hH-851aafed-d085-49ed-b189-3bfd90a8e573">
</div>

<div id="outline-container-orgef90995" class="outline-3">
<h3 id="hH-273880cf-f38b-40bd-8ea0-95d03d668b29"><a id="orgef90995"></a><span class="section-number-3">1.1</span> Availability</h3>
<div class="outline-text-3" id="text-hH-273880cf-f38b-40bd-8ea0-95d03d668b29">
<p>
Source code for Thespian is available at
<a href="https://github.com/kquick/Thespian">https://github.com/kquick/Thespian</a> under the MIT license.
</p>
</div>
</div>

<div id="outline-container-orge566251" class="outline-3">
<h3 id="hH-9ebe8005-1460-4634-bead-237826702ea2"><a id="orge566251"></a><span class="section-number-3">1.2</span> Documentation</h3>
<div class="outline-text-3" id="text-hH-9ebe8005-1460-4634-bead-237826702ea2">
<p>
Thespian documentation is maintained in the source tree under the
<code>doc/</code> directory.  Documentation is written in Emacs orgmode,
which allows export as PDF, HTML, text, and other formats.
</p>

<p>
HTML output uses the <code>htmlize</code> package for syntax coloring, and
the <code>bigblow</code> theme from Fabrice Niessen at
<a href="https://github.com/fniessen/org-html-themes">https://github.com/fniessen/org-html-themes</a>.
</p>

<p>
Documentation should be generated using the <code>doc/gen_html.sh</code> or
<code>doc/gen_pdf.sh</code> bash script and specifying the source file for
the document to be generated; the results are generated in the
same <code>doc/</code> directory.
</p>

<pre class="example">
$ bash doc/gen_html.sh doc/using.org
</pre>
</div>
</div>

<div id="outline-container-orgeec2456" class="outline-3">
<h3 id="hH-e9695953-86ef-420c-a33a-4a0db2455a04"><a id="orgeec2456"></a><span class="section-number-3">1.3</span> Issues</h3>
<div class="outline-text-3" id="text-hH-e9695953-86ef-420c-a33a-4a0db2455a04">
<p>
Any issues should be posted via the <a href="https://github.com/kquick/Thespian">main Thespian github page</a>.
</p>
</div>
</div>

<div id="outline-container-org761c53a" class="outline-3">
<h3 id="hH-a0f114cf-cfc2-4ae6-a852-a4db84986f57"><a id="org761c53a"></a><span class="section-number-3">1.4</span> Contributions</h3>
<div class="outline-text-3" id="text-hH-a0f114cf-cfc2-4ae6-a852-a4db84986f57">
<p>
Contributions (both source and documentation) should be in the
form of pull requests.  Contributions will not be accepted until
the contributor has agreed to the contributor's agreement.
Thespian uses the <a href="https://cla-assistant.io">cla-assistant.io</a> which will automatically check
to see if a contributor has click-signed the contributor's
agreement; as a contributor you will automatically be given a link
to sign the agreement when you make your contribution.
</p>
</div>
</div>
</div>

<div id="outline-container-orge57157c" class="outline-2">
<h2 id="hH-701a67c8-8882-49ff-928c-14ae0b663cbf"><a id="orge57157c"></a><span class="section-number-2">2</span> Testing</h2>
<div class="outline-text-2" id="text-hH-701a67c8-8882-49ff-928c-14ae0b663cbf">
</div>

<div id="outline-container-org7ab4478" class="outline-3">
<h3 id="hH-1c7bb213-1e22-455e-b767-c9a6a1a5cd68"><a id="org7ab4478"></a><span class="section-number-3">2.1</span> Approach</h3>
<div class="outline-text-3" id="text-hH-1c7bb213-1e22-455e-b767-c9a6a1a5cd68">
<p>
While there are some Thespian tests that use mocking to reduce the
effects of external elements, the main focus of Thespian testing is
<b>functional</b> testing to make sure that the ActorSystem is providing
proper functionality for the Actors that will be running.  Writing
mock'ed unit tests for Thespian is still a welcome contribution, we
have just focused our primary efforts on the functional tests.
</p>

<p>
This functional approach means that the tests will actually create
threads or processes (depending on the systembase) and that all
systembases are tested on the same set of tests.
</p>
</div>
</div>

<div id="outline-container-org19e4f25" class="outline-3">
<h3 id="hH-f099ef66-5ab1-45d7-a700-b065f885ca75"><a id="org19e4f25"></a><span class="section-number-3">2.2</span> Test Duration</h3>
<div class="outline-text-3" id="text-hH-f099ef66-5ab1-45d7-a700-b065f885ca75">
<p>
Because of the approach above running the tests can take some time.
Test can even can hang if there is bad code or if system resources
become exhausted (e.g. no more sockets available), and there can be
spurious effects from the real world (e.g. timing failures if the
local system is excessively busy).
</p>

<p>
Every effort is made to have tests run quickly and reliably, but
validating functionality is the most important goal.
</p>

<p>
As of Thespian 3.7.0, the full test suite duration is approximately
1500 seconds.
</p>
</div>
</div>

<div id="outline-container-orgad31119" class="outline-3">
<h3 id="hH-1dfd22a5-0c88-4d8e-8e0d-5383a503678a"><a id="orgad31119"></a><span class="section-number-3">2.3</span> Testing System Bases</h3>
<div class="outline-text-3" id="text-hH-1dfd22a5-0c88-4d8e-8e0d-5383a503678a">
<p>
Because all systembases are tested, it is necessary to accomodate
the differences between those system bases.  For most Actors, there
should be no difference between systembases and they should be
unaware of which one is running, but it is not practical for all
systembases to support all features; the administrator starting the
ActorSystem is responsible for starting a system appropriate to the
task and Actors at hand.
</p>

<p>
Some of the system bases do not support some features (as detailed
<a href="https://thespianpy.com/doc/using.html#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">here in the Using Thespian guide</a>) and so there are inputs provided
to the tests to indicate which are viable and/or stable.  More on
this in the Running Tests section below.
</p>
</div>
</div>

<div id="outline-container-org2e5c707" class="outline-3">
<h3 id="hH-a992a85a-623f-47c8-a810-deefcb82a521"><a id="org2e5c707"></a><span class="section-number-3">2.4</span> Running Tests</h3>
<div class="outline-text-3" id="text-hH-a992a85a-623f-47c8-a810-deefcb82a521">
<p>
Tests are written to fairly conventional Python unittest standards
without relying on plugins.  Tests are normally run via the pytest
package (run via <code>$ py.test</code>), and the latter provides various
testing controls.
</p>

<p>
For simple, direct runs of specific tests, direct nose invocation of
those tests is usually sufficient:
</p>

<pre class="example">
$ py.test thespian/test/testSimpleActor.py::TestASimpleSystem
</pre>

<p>
As discussed above, all system bases are tested (by default) so the
<code>simpleSystemBase</code> is usually covered by the <code>TestASimpleSystem</code>
testcase so that it is tested before any of the more complex system
bases (due to alphabetically appearing first).
</p>

<p>
The viability and focus of individual testcases is specified using
methods from the <code>thespian/test/__init__.py</code> file:
</p>

<dl class="org-dl">
<dt>unstable_test</dt><dd><p>
     Specifies that the test is unstable for the specified base and
should be skipped. The features tested may usually work, but are
not reliably supported by the underlying base (e.g. the UDP
transport does not provide delivery guarantees, so hi-traffic
tests are marked with <code>unstable_test("multiprocUDPBase")</code>
</p>

<pre class="example">
     unstable_test(asys, basename[, ...])
</pre></dd>

<dt>actor_system_unsupported</dt><dd><p>
     Specifies that the functionality being tested is not supported by
this particular system base and the test should be skipped for
the indicated base(s).
</p>

<pre class="example">
     actor_system_unsupported(asys, basename [,...])
</pre></dd>
</dl>


<p>
When running the tests from the command line, the normal
pytest-based commands can be used, with optional attribute
specifiers to identify tests, categories ("Func" or "Unit"), and
system bases.  For example, to run all unit tests:
</p>

<pre class="example">
$ py.test -k Unit
</pre>

<p>
The above is saved in <code>scripts/run_unit_tests.sh</code> for convenient
re-use.  In addition, the <code>scripts/run_main_functional_tests.sh</code> file
contains the following specification which is used to run all the
stable functional tests for the standard set of testbases:
</p>

<pre class="example">
$ py.test -k Func
</pre>
</div>
</div>

<div id="outline-container-orgb7e78ab" class="outline-3">
<h3 id="hH-bf031295-256d-471e-922a-808a77c3fbec"><a id="orgb7e78ab"></a><span class="section-number-3">2.5</span> Writing Tests</h3>
<div class="outline-text-3" id="text-hH-bf031295-256d-471e-922a-808a77c3fbec">
<p>
When writing tests for Thespian, there is an <code>asys</code> fixture for pytest
that provides an initialized ActorSystem for each system base.
Writing the test to accept <code>asys</code> as a parameter will cause pytest to
run the test once for each system base type.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Kevin Quick &lt;quick@sparq.org&gt;</p>
<p class="date">Created: 2019-03-06 Wed 00:01</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
